<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Leverantörssidan</title>
    <style>
      h1, ul, label {
        font-family: Helvetica, sans-serif
      }
      
    </style>
  </head>
  <body>
    <h1>Välkommen <%= p.producer %> ! Fyll på godis nedan:</h1>

    <form action="/producer" method="POST">
        <div>
          <label for="name">Namn: </label>
          <input type="text" id="name" name="name" required />
        </div>
     
     
        <div>
          <label for="type">Typ: </label>
          <input type="text" id="type" name="type" required />
        </div>
      
      <div>
        <label for="price">Pris (öre)/gram: </label>
        <input type="number" id="price" name="price" required />
      </div>

      
      <div>
        <label for="additional">Extra info: </label>
        Gelatin:
        <input type="checkbox" value="Gelatin" name="additional">
        Nötter:
        <input type="checkbox" value="Nötter" name="additional">
      </div>
    
      <div>
        <label for="stock">Antal i lager: </label>
        <input type="number" id="stock" name="stock" required />
      </div>

    
      
      <button type="submit">Lägg till godis</button>
    </form>

    <h2>Här är dina varor:</h2>
    
    <ul class="p">
      <% for(let i=0; i < p.products.length; i++) {%>
      <li class="p">
        <span><%= p.products[i].name %></span>
        <span>(<%= p.products[i].additional %>)</span>
        <span>(<%= p.products[i].stock %> i lager)</span>
        <button id= <%= p.products[i]._id %> onClick="deleteReq(this.id)" >Ta bort</button>

        <!-- lyckades inte få detta att funka -->

        <button id= <%= p.products[i].name %>  onClick="addAmount(<%= p.products[i].name %>)" >Fyll på</button>
      </li>
      <% } %>
    </ul>


    <script>
      const deleteReq = clickedId => {
    fetch('producer', {
        method: 'delete',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ id: clickedId }),
    })
        .then(res => {
            if (res.ok) return res.json()
        })
        .then(data => {
            console.log(data)
            window.location.reload(true)
        })
}
//lyckades inte få detta att funka..
const addAmount = (newAmount) => {
  console.log(newAmount)
  fetch('producer', {
    method: 'patch',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({stock: newAmount})
  })
  .then(res =>{
    if (res.ok) return res.json()
  } )
  .then(data => {
    console.log(data)
  })
}

const testStock = (stockvalue) => {
  console.log(stockvalue)
}

    </script>
  </body>
</html>
